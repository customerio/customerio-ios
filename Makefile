SHELL = /bin/sh

# --args:
#   diAccessLevel - access level of the dependency injection graph. If module is used by another module (like Cio) then you want `public`. Else, `internal`. 
#   moduleName - the name of the module that you are generating code for. 
#   imports - Import statements to be at the top of the generated files in case the file needs classes from other modules. Split by `:` (example: `imports=Cio-Foo-Bar`) 
generate:
	sourcery --sources Sources/Tracking --templates Sources/Templates --output Sources/Tracking/autogenerated --args diAccessLevel=public,moduleName=Tracking
	sourcery --sources Sources/MessagingPush --templates Sources/Templates --output Sources/MessagingPush/autogenerated --args diAccessLevel=public,moduleName=MessagingPush,imports=CioTracking
	sourcery --sources Sources/MessagingPushAPN --templates Sources/Templates --output Sources/MessagingPushAPN/autogenerated --args diAccessLevel=internal,moduleName=MessagingPushAPN,imports=CioMessagingPush:CioTracking
	sourcery --sources Sources/MessagingPushFCM --templates Sources/Templates --output Sources/MessagingPushFCM/autogenerated --args diAccessLevel=internal,moduleName=MessagingPushFCM,imports=CioMessagingPush:CioTracking

lint:
	swiftlint lint --strict

# specify swiftversion this way instead of .swift-version to (1) keep project files slim and (2) we can specify the version in a CI server matrix for multiple version testing. 
# use the min Swift version that we support/test against. 
format:
	swiftformat . --swiftversion 5.3 && swiftlint lint --fix

# Check what code has not yet had documentation written for it. 
# Jazzy is a great tool that generates docs, yes, but also tells you what public facing code is missing docs. 
# This command will simply show you the output of the undocumented code of jazzy. It's not the most human-readable but it will do for now. 
check-undocumented:
	jazzy --module CioTracking --swift-build-tool spm --output /tmp/CioTrackingDocs > /dev/null 2>&1 && cat /tmp/CioTrackingDocs/undocumented.json
	jazzy --module CioMessagingPush --swift-build-tool spm --output /tmp/CioMessagingPushDocs > /dev/null 2>&1 && cat /tmp/CioMessagingPushDocs/undocumented.json
